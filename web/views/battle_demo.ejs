<% include head %>

<h1>Battle Demo</h1>
<dl class="dl-horizontal">
  <dt>Submit Date</dt><dd><%=: rec.submitDate | formatDate %></dd>
  <% if (rec.status === 'Pending') { %>
    <dt>AI 1</dt><dd><a href="/ai/<%= rec.ids[0] %>"><%= rec.name0 %></a> of <small><%= rec.user0 %> (<%= rec.idOfUser0 %>)</small></dd>
    <dt>AI 2</dt><dd><a href="/ai/<%= rec.ids[1] %>"><%= rec.name1 %></a> of <small><%= rec.user1 %> (<%= rec.idOfUser1 %>)</small></dd>
    <dt>Status</dt><dd><span id="span-status" class="label label-default"><%= rec.status %></span></dd>
    <dt>Current Steps</dt><dd id="dd-steps"></dd>
  <% } else if (rec.status === 'Running') { %>
    <dt>AI 1</dt><dd><a href="/ai/<%= rec.ids[0] %>"><%= rec.name0 %></a> of <small><%= rec.user0 %> (<%= rec.idOfUser0 %>)</small></dd>
    <dt>AI 2</dt><dd><a href="/ai/<%= rec.ids[1] %>"><%= rec.name1 %></a> of <small><%= rec.user1 %> (<%= rec.idOfUser1 %>)</small></dd>
    <dt>Status</dt><dd><span id="span-status" class="label label-warning"><%= rec.status %></span></dd>
    <dt>Current Steps</dt><dd id="dd-steps"><img src="/images/jumping-ball.gif"><span id="span-steps">loading</span></dd>
  <% } else { %>
    <dt>AI 1</dt><dd><a href="/ai/<%= rec.ids[0] %>"><%= rec.name0 %></a> of <small><%= rec.user0 %> (<%= rec.idOfUser0 %>)</small>
      <a href="/battle/<%= rec._id %>/stderr/1/<%=: rec.submitDate | formatDate %> [AI1]<%= rec.name0 %>.txt">(stderr)</a></dd>
    <dt>AI 2</dt><dd><a href="/ai/<%= rec.ids[1] %>"><%= rec.name1 %></a> of <small><%= rec.user1 %> (<%= rec.idOfUser1 %>)</small>
      <a href="/battle/<%= rec._id %>/stderr/2/<%=: rec.submitDate | formatDate %> [AI2]<%= rec.name1 %>.txt">(stderr)</a></dd>
    <dt>Battle Date</dt><dd><%=: rec.runDate | formatDate %></dd>
    <dt>Status</dt><dd><%= rec.status %></dd>
    <dt>Total Steps</dt><dd><%= rec.step %></dd>
    <% if (rec.result == 0) { %>
      <dt>Winner</dt><dd><span class="label label-success"><%= rec.name0 %> of <small><%= rec.user0 %> (<%= rec.idOfUser0 %>)</small></span></dd>
      <dt>Loser</dt><dd><span class="label label-danger"><%= rec.name1 %> of <small><%= rec.user1 %> (<%= rec.idOfUser1 %>)</small></span></dd>
    <% } else if (rec.result == 1) { %>
      <dt>Winner</dt><dd><span class="label label-success"><%= rec.name1 %> of <small><%= rec.user1 %> (<%= rec.idOfUser1 %>)</small></span></dd>
      <dt>Loser</dt><dd><span class="label label-danger"><%= rec.name0 %> of <small><%= rec.user0 %> (<%= rec.idOfUser0 %>)</small></span></dd>
    <% } else if (rec.result == 2) { %>
      <dt>Result</dt><dd><span class="label label-warning">Draw</span></dd>
    <% } %>
  <% } %>
</dl>

<% if (rec.status === 'Finished') { %>
<div id="demo-info">
  <ul id="invalid-list" class="list-group">
  </ul>
  <div>
    <div class="btn-group noselect">
      <button class="btn btn-sm btn-primary" disabled id="btn-prev"><span class="glyphicon glyphicon-chevron-left" id="span-prev" aria-hidden="true"></span></button>
      <button class="btn btn-sm btn-primary" disabled id="btn-play"><span id="span-play">Loading Demo...</span></button>
      <button class="btn btn-sm btn-primary" disabled id="btn-next"><span class="glyphicon glyphicon-chevron-right" id="span-next" aria-hidden="true"></span></button>
    </div>
    <div class="btn-group noselect">
      <button id="btn-speed-slow" class="btn btn-sm btn-success">Slow</button>
      <button id="btn-speed-normal" class="btn btn-sm btn-warning">Normal</button>
      <button id="btn-speed-fast" class="btn btn-sm btn-danger">Fast</button>
    </div>
  </div>
  <p id="demo-text" class="bg-primary">Total Step: <%= rec.step %></p>
</div>

<table id="chess-board" class="noselect">
</table>
<div id="float-chess" class="hidden"></div>
<% } %>

<% include foot_script %>
<% if (rec.status === 'Finished') { %>
<script src="<%= settings.staticCDN %>/js/demo.js?20141208"></script>
<script>Demo.setup("<%= rec._id %>.json");</script>
<% } else { %>
<script src="<%= settings.staticCDN %>/js/refresh_steps.js?20141212"></script>
<script>refresh_step("<%= rec._id %>-steps.json");</script>
<% } %>
<% include foot_close %>
